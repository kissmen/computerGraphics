cbuffer staticMeshBuffer : register(b0)
{
    float4x4 W;
    float4x4 VP;
};

cbuffer grassParams : register(b1)
{
    float uTime;
    float strength;
    float scaleVal;
    float pad;
    float3 uColor;
    float pad2;
};

struct VS_INPUT
{
    float3 Pos : POS;
    float3 Normal : NORMAL;
    float3 Tangent : TANGENT;
    float2 TexCoords : TEXCOORD;
    float3 InstancePosition : INSTANCEPOSITION;
};

struct VS_OUTPUT
{
    float4 Pos : SV_POSITION;
    float2 TexCoords : TEXCOORD;
};

VS_OUTPUT VS(VS_INPUT input)
{
    float3 worldPos = input.Pos + input.InstancePosition;
    float height = 20.0f;

    float factor = saturate(worldPos.y/height);

    float swayY = sin(worldPos.x*2.0 + uTime*2.0)*0.1;
    float swayX = sin(worldPos.z*3.0 + uTime*1.5)*0.05;
    float swayZ = sin(worldPos.x*3.0 + uTime*1.5)*0.05;

    worldPos.y += swayY*strength*factor;
    worldPos.x += swayX*strength*factor;
    worldPos.z += swayZ*strength*factor;

    float4 wpos = mul(float4(worldPos,1),W);
    VS_OUTPUT output;
    output.Pos = mul(wpos,VP);
    output.TexCoords = input.TexCoords * scaleVal;
    return output;
}